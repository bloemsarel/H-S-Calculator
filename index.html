<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2196F3">
  <meta name="description" content="Holliday-Segar Fluid Calculator with fluid recommendations by condition">
  <title>H-S Fluid Calculator</title>
  <link rel="manifest" href="manifest.json">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      overflow: hidden;
    }
    
    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px;
      text-align: center;
    }
    
    header h1 {
      font-size: 1.8em;
      margin-bottom: 5px;
    }
    
    header p {
      opacity: 0.9;
      font-size: 0.9em;
    }
    
    .install-container {
      background: #f0f4ff;
      padding: 15px;
      text-align: center;
      border-bottom: 2px solid #e0e7ff;
    }
    
    #installButton {
      display: none;
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 1em;
      border-radius: 25px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
      transition: all 0.3s ease;
    }
    
    #installButton:hover {
      background: #45a049;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
    }
    
    .tabs {
      display: flex;
      background: #f8f9fa;
      border-bottom: 2px solid #e9ecef;
    }
    
    .tab {
      flex: 1;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      border: none;
      background: transparent;
      font-size: 1em;
      font-weight: 600;
      color: #495057;
      transition: all 0.3s ease;
    }
    
    .tab:hover {
      background: #e9ecef;
    }
    
    .tab.active {
      background: white;
      color: #667eea;
      border-bottom: 3px solid #667eea;
    }
    
    .tab-content {
      display: none;
      padding: 30px;
      animation: fadeIn 0.3s ease;
    }
    
    .tab-content.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }
    
    input, select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e7ff;
      border-radius: 8px;
      font-size: 1em;
      transition: border-color 0.3s ease;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    button {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-calculate {
      background: #667eea;
      color: white;
    }
    
    .btn-calculate:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    .btn-reset {
      background: #e0e7ff;
      color: #667eea;
    }
    
    .btn-reset:hover {
      background: #c7d2fe;
    }
    
    .btn-diagnosis {
      background: #10b981;
      color: white;
    }
    
    .btn-diagnosis:hover {
      background: #059669;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }
    
    #result {
      margin-top: 25px;
      padding: 20px;
      background: #f0f4ff;
      border-radius: 8px;
      border-left: 4px solid #667eea;
      white-space: pre-line;
      line-height: 1.8;
    }
    
    #result:empty {
      display: none;
    }
    
    .condition-card {
      background: #ffffff;
      border: 2px solid #e0e7ff;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .condition-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }
    
    .condition-title {
      font-size: 1.3em;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .fluid-info {
      margin: 10px 0;
    }
    
    .fluid-label {
      font-weight: 600;
      color: #495057;
      margin-bottom: 5px;
    }
    
    .fluid-value {
      color: #212529;
      padding-left: 15px;
      margin-bottom: 8px;
    }
    
    .warning {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
      font-size: 0.95em;
    }
    
    .section-title {
      font-size: 1.5em;
      font-weight: bold;
      color: #333;
      margin: 30px 0 20px 0;
      padding-bottom: 10px;
      border-bottom: 3px solid #667eea;
    }
    
    @media (max-width: 600px) {
      .button-group {
        flex-direction: column;
      }
      
      header h1 {
        font-size: 1.4em;
      }
      
      .tab {
        font-size: 0.9em;
        padding: 12px 8px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üíß Holliday-Segar Fluid Calculator</h1>
      <p>Comprehensive fluid management and diagnosis tool</p>
    </header>
    
    <div class="install-container">
      <button id="installButton">üì≤ Install App on Your Device</button>
    </div>
    
    <div class="tabs">
      <button class="tab active" onclick="switchTab('calculator')">Calculator</button>
      <button class="tab" onclick="switchTab('recommendations')">Fluid Recommendations</button>
    </div>
    
    <div id="calculator" class="tab-content active">
      <div class="form-group">
        <label for="weight">Enter Weight (kg):</label>
        <input type="number" id="weight" step="0.1" placeholder="Enter patient weight">
      </div>
      
      <div class="form-group">
        <label for="diagnosis">Select Diagnosis:</label>
        <select id="diagnosis">
          <option value="">-- Choose a condition --</option>
          <option value="Blood loss">Blood loss (hemorrhage)</option>
          <option value="Vomiting">Vomiting</option>
          <option value="Diarrhea">Diarrhea</option>
          <option value="Diabetic rehydration (DKA)">Diabetes & Diabetic Ketoacidosis (DKA)</option>
          <option value="Cardiogenic shock">Cardiogenic & Neurogenic Shock</option>
          <option value="Reduced intake">Reduced intake of fluids (elderly)</option>
          <option value="Heat dehydration">Heat dehydration</option>
          <option value="Excessive burns">Excessive burns</option>
          <option value="Sepsis">Sepsis / Septic shock</option>
          <option value="Post operative">Post operative patients</option>
          <option value="Renal impairment">Renal impairment</option>
          <option value="Hepatic failure">Hepatic failure</option>
        </select>
      </div>
      
      <div class="button-group">
        <button class="btn-calculate" onclick="calculateVolume()">Calculate Volume</button>
        <button class="btn-diagnosis" onclick="showDiagnosisRecommendation()">Get Fluid Recommendation</button>
        <button class="btn-reset" onclick="resetFields()">Reset</button>
      </div>
      
      <div id="result"></div>
    </div>
    
    <div id="recommendations" class="tab-content">
      <h2 class="section-title">ü©∫ Recommended Fluids by Condition</h2>
      
      <div class="condition-card">
        <div class="condition-title">ü©∏ Blood loss (hemorrhage)</div>
        <div class="fluid-info">
          <div class="fluid-label">First line:</div>
          <div class="fluid-value">Ringer's Lactate (RL) or Normal Saline (NS)</div>
        </div>
        <div class="warning">‚ö†Ô∏è Colloids or blood products may be required depending on severity.</div>
      </div>
      
      <div class="condition-card">
        <div class="condition-title">ü§¢ Vomiting</div>
        <div class="fluid-info">
          <div class="fluid-label">First line:</div>
          <div class="fluid-value">Normal Saline (NS)</div>
          <div class="fluid-label">Alternative:</div>
          <div class="fluid-value">RL if metabolic alkalosis suspected</div>
        </div>
        <div class="warning">‚ö†Ô∏è Monitor potassium replacement.</div>
      </div>
      
      <div class="condition-card">
        <div class="condition-title">üíß Diarrhea</div>
        <div class="fluid-info">
          <div class="fluid-label">First line:</div>
          <div class="fluid-value">Oral Rehydration Solution (ORS) if mild/moderate</div>
          <div class="fluid-label">Severe:</div>
          <div class="fluid-value">NS or RL IV</div>
        </div>
        <div class="warning">‚ö†Ô∏è Replace potassium losses.</div>
      </div>
      
      <div class="condition-card">
        <div class="condition-title">üç¨ Diabetes & Diabetic Ketoacidosis (DKA)</div>
        <div class="fluid-info">
          <div class="fluid-label">First line:</div>
          <div class="fluid-value">Balsol or Plasmalyte B (balanced crystalloids preferred)</div>
          <div class="fluid-label">Alternative:</div>
          <div class="fluid-value">NS initially if unavailable</div>
        </div>
        <div class="warning">‚ö†Ô∏è Careful monitoring of glucose, potassium, and acid‚Äìbase status.</div>
      </div>
      
      <div class="condition-card">
        <div class="condition-title">‚ù§Ô∏è Cardiogenic & Neurogenic Shock</div>
        <div class="fluid-info">
          <div class="fluid-label">First line:</div>
          <div class="fluid-value">NS or RL cautiously</div>
        </div>
        <div class="warning">‚ö†Ô∏è Avoid fluid overload; vasopressors often required.</div>
      </div>
      
      <div class="condition-card">
        <div class="condition-title">üë¥ Reduced intake of fluids (especially in the aged)</div>
        <div class="fluid-info">
          <div class="fluid-label">First line:</div>
          <div class="fluid-value">NS or RL (gentle maintenance)</div>
        </div>
        <div class="warning">‚ö†Ô∏è Adjust for renal/cardiac function.</div>
      </div>
      
      <div class="condition-card">
        <div class="condition-title">üå°Ô∏è Heat dehydration</div>
        <div class="fluid-info">
          <div class="fluid-label">First line:</div>
          <div class="fluid-value">ORS (oral if possible)</div>
          <div class="fluid-label">Severe:</div>
          <div class="fluid-value">NS or RL IV</div>
        </div>
        <div class="warning">‚ö†Ô∏è Monitor sodium to avoid rapid correction.</div>
      </div>
      
      <div class="condition-card">
        <div class="condition-title">üî• Excessive burns</div>
        <div class="fluid-info">
          <div class="fluid-label">First line:</div>
          <div class="fluid-value">RL (Parkland formula guidance)</div>
        </div>
        <div class="warning">‚ö†Ô∏è Strict monitoring of urine output and electrolytes.</div>
      </div>
      
      <h2 class="section-title">üîç Other Situations Requiring Fluid Maintenance</h2>
      
      <div class="condition-card">
        <div class="condition-title">ü¶† Sepsis / Septic shock</div>
        <div class="fluid-info">
          <div class="fluid-value">RL or Plasmalyte B preferred</div>
        </div>
      </div>
      
      <div class="condition-card">
        <div class="condition-title">üè• Post operative patients</div>
        <div class="fluid-info">
          <div class="fluid-value">NS or RL for maintenance, adjust for surgical losses</div>
        </div>
      </div>
      
      <div class="condition-card">
        <div class="condition-title">ü´ò Renal impairment</div>
        <div class="fluid-info">
          <div class="fluid-value">Avoid potassium containing fluids unless levels are low</div>
        </div>
      </div>
      
      <div class="condition-card">
        <div class="condition-title">ü´Ä Hepatic failure</div>
        <div class="fluid-info">
          <div class="fluid-value">Prefer NS, avoid lactate containing fluids if severe liver dysfunction</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Enhanced fluid recommendations with detailed protocols
    const fluidRecommendations = {
      "Blood loss": {
        rehydration: "Ringer's Lactate (RL) or Normal Saline (NS)",
        maintenance: "Balanced crystalloid",
        notes: "Colloids or blood products may be required depending on severity. Early blood products if significant hemorrhage; avoid excessive saline load."
      },
      "Vomiting": {
        rehydration: "Normal Saline (NS)",
        maintenance: "Dextrose-saline (e.g., D5 0.45% NaCl) with KCl once urine output confirmed",
        notes: "RL if metabolic alkalosis suspected. Monitor potassium replacement. Replace chloride; monitor potassium and glucose."
      },
      "Diarrhea": {
        rehydration: "Oral Rehydration Solution (ORS) if mild/moderate; NS or RL IV if severe",
        maintenance: "Dextrose-saline with KCl",
        notes: "Replace potassium losses. RL helps buffer metabolic acidosis; add KCl after urine output."
      },
      "Diabetic rehydration (DKA)": {
        rehydration: "Balsol or Plasmalyte B (balanced crystalloids preferred). NS initially if unavailable",
        maintenance: "Switch to dextrose-containing balanced fluids once glucose is near target",
        notes: "Careful monitoring of glucose, potassium, and acid‚Äìbase status. Run insulin and K+ separately; reassess corrected sodium frequently."
      },
      "Cardiogenic shock": {
        rehydration: "NS or RL cautiously",
        maintenance: "Minimal maintenance, vasopressor support",
        notes: "Avoid fluid overload; vasopressors often required. Monitor closely for pulmonary edema."
      },
      "Reduced intake": {
        rehydration: "NS or RL (gentle maintenance)",
        maintenance: "Balanced maintenance fluids",
        notes: "Adjust for renal/cardiac function. Monitor for signs of fluid overload in elderly patients."
      },
      "Heat dehydration": {
        rehydration: "ORS (oral if possible); NS or RL IV if severe",
        maintenance: "Balanced maintenance once rehydrated",
        notes: "Monitor sodium to avoid rapid correction. Watch for heat-related complications."
      },
      "Excessive burns": {
        rehydration: "Ringer's Lactate (Parkland formula guidance)",
        maintenance: "Balanced maintenance with dextrose and KCl, titrated to urine output",
        notes: "Strict monitoring of urine output and electrolytes. Half total in first 8h from time of burn, remainder over next 16h."
      },
      "Sepsis": {
        rehydration: "RL or Plasmalyte B preferred",
        maintenance: "Balanced crystalloids with glucose monitoring",
        notes: "Early goal-directed therapy. Consider vasopressor support if hypotensive despite fluids."
      },
      "Post operative": {
        rehydration: "NS or RL for maintenance, adjust for surgical losses",
        maintenance: "Standard maintenance with electrolyte monitoring",
        notes: "Account for ongoing losses (drains, NG tubes). Monitor closely in first 24 hours."
      },
      "Renal impairment": {
        rehydration: "Avoid potassium containing fluids unless levels are low",
        maintenance: "Potassium-free maintenance fluids",
        notes: "Close monitoring of renal function and electrolytes. Adjust volumes based on urine output."
      },
      "Hepatic failure": {
        rehydration: "Prefer NS, avoid lactate containing fluids if severe liver dysfunction",
        maintenance: "NS-based maintenance",
        notes: "Avoid RL in severe hepatic dysfunction. Monitor for hepatic encephalopathy and coagulopathy."
      }
    };

    // Holliday-Segar calculation
    function hollidaySegar(weight) {
      let daily_ml;
      if (weight <= 10) {
        daily_ml = weight * 100;
      } else if (weight <= 20) {
        daily_ml = (10 * 100) + (weight - 10) * 50;
      } else {
        daily_ml = (10 * 100) + (10 * 50) + (weight - 20) * 20;
      }
      const hourly_ml = daily_ml / 24;
      return { daily_ml: daily_ml.toFixed(1), hourly_ml: hourly_ml.toFixed(2) };
    }

    // Calculate and display
    function calculateVolume() {
      const weight = parseFloat(document.getElementById('weight').value);
      const diagnosis = document.getElementById('diagnosis').value;
      const resultDiv = document.getElementById('result');

      if (isNaN(weight) || weight <= 0) {
        resultDiv.innerHTML = "<strong style='color: #dc3545;'>‚ö†Ô∏è Please enter a valid weight.</strong>";
        return;
      }

      const result = hollidaySegar(weight);
      const rehydration_volume = (weight * 20).toFixed(1);

      let text = `<strong>üìä Calculation Results</strong>\n\n`;
      text += `Weight: ${weight} kg\n`;
      text += `Daily Maintenance: ${result.daily_ml} mL/day\n`;
      text += `Hourly Rate: ${result.hourly_ml} mL/hr\n`;
      text += `Rehydration Volume (20 ml/kg): ${rehydration_volume} mL`;

      if (diagnosis && fluidRecommendations[diagnosis]) {
        const rec = fluidRecommendations[diagnosis];
        text += `\n\n<strong>üíä Fluid Protocol for ${diagnosis}</strong>\n\n`;
        text += `<strong>Rehydration:</strong> ${rec.rehydration}\n`;
        text += `<strong>Maintenance:</strong> ${rec.maintenance}\n`;
        text += `<strong>Notes:</strong> ${rec.notes}`;
      }

      resultDiv.innerHTML = text;
    }

    // Show diagnosis recommendation only
    function showDiagnosisRecommendation() {
      const diagnosis = document.getElementById('diagnosis').value;
      const resultDiv = document.getElementById('result');

      if (!diagnosis) {
        resultDiv.innerHTML = "<strong style='color: #dc3545;'>‚ö†Ô∏è Please select a diagnosis first.</strong>";
        return;
      }

      if (fluidRecommendations[diagnosis]) {
        const rec = fluidRecommendations[diagnosis];
        let text = `<strong>üíä Recommended Fluids for ${diagnosis}</strong>\n\n`;
        text += `<strong>Rehydration Fluid:</strong>\n${rec.rehydration}\n\n`;
        text += `<strong>Maintenance Fluid:</strong>\n${rec.maintenance}\n\n`;
        text += `<strong>Clinical Notes:</strong>\n${rec.notes}`;
        resultDiv.innerHTML = text;
      }
    }

    // Reset fields
    function resetFields() {
      document.getElementById('weight').value = "";
      document.getElementById('diagnosis').value = "";
      document.getElementById('result').innerHTML = "";
      document.getElementById('weight').focus();
    }

    // Tab switching
    function switchTab(tabName) {
      // Hide all tabs
      const tabs = document.querySelectorAll('.tab-content');
      tabs.forEach(tab => tab.classList.remove('active'));
      
      // Remove active from all tab buttons
      const tabButtons = document.querySelectorAll('.tab');
      tabButtons.forEach(btn => btn.classList.remove('active'));
      
      // Show selected tab
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
    }

    // PWA Installation
    let deferredPrompt;
    const installButton = document.getElementById('installButton');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installButton.style.display = 'inline-block';
    });

    installButton.addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`User response to install prompt: ${outcome}`);
        deferredPrompt = null;
        installButton.style.display = 'none';
      }
    });

    window.addEventListener('appinstalled', () => {
      console.log('PWA installed successfully');
      installButton.style.display = 'none';
    });

    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(registration => console.log('Service Worker registered'))
        .catch(err => console.log('Service Worker registration failed:', err));
    }
  </script>
</body>
</html>
